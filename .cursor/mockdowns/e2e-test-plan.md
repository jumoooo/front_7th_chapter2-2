# E2E 테스트 (`pnpm test:e2e:ui`) 성공 계획서

> **최종 목표**: `pnpm test:e2e:ui` 명령을 실행했을 때 모든 Playwright E2E 테스트가 성공적으로 통과하도록 애플리케이션의 버그를 수정합니다.

---

### 1. 테스트 도구 및 환경

-   **테스트 프레임워크**: Playwright
-   **실행 명령**: `pnpm test:e2e:ui`
-   **실행 환경**: Playwright UI 모드 (`--ui`)

---

### 2. 전체 작업 흐름

이 작업은 **사용자와 AI 에이전트의 긴밀한 협력**이 필요합니다. AI는 코드를 분석하고 수정하며, 사용자는 Playwright UI를 통해 실제 테스트를 실행하고 결과를 AI에게 전달하는 역할을 합니다.

아래의 **[분석 -> 가설 수립 -> 조사 -> 수정 -> 검증 요청]** 사이클을 반복하여 모든 테스트를 통과시킵니다.

#### **1단계: 초기 테스트 실행 및 실패 분석**

1.  **[사용자]** 터미널에서 `pnpm test:e2e:ui`를 실행하여 Playwright UI를 엽니다.
2.  **[사용자]** 왼쪽 상단의 "Run all" 버튼을 클릭하여 전체 테스트를 실행합니다.
3.  **[사용자]** 실패하는 **첫 번째 테스트**를 AI에게 알려줍니다. 다음 정보를 포함해야 합니다.
    -   실패한 테스트 파일명과 테스트 이름
    -   Playwright UI에 표시되는 에러 메시지 (예: `Timeout waiting for...`, `Expected text... but got...`)
    -   실패 시점의 스크린샷이나 Trace 뷰어의 정보 (가능하다면)

#### **2단계: 가설 수립 및 조사 계획**

1.  **[AI]** 전달받은 실패 정보를 바탕으로 가장 유력한 원인에 대한 가설을 세웁니다.
    -   **예시 1 (엘리먼트 없음)**: "에러 로그 `Timeout waiting for selector ".cart-item"`는 장바구니 아이템이 렌더링되지 않았음을 의미합니다. 이는 `app` 패키지의 `CartItem` 컴포넌트나 `cartStore`의 상태 관리에 문제가 있을 수 있습니다."
    -   **예시 2 (잘못된 동작)**: "버튼 클릭 후 '성공' 토스트가 떠야 하는데 '실패' 토스트가 떴습니다. 이는 `app` 패키지의 `cartService` 또는 `react` 라이브러리의 이벤트 처리 로직에 버그가 있을 수 있습니다."
2.  **[AI]** 가설을 검증하기 위해 읽어야 할 파일 목록(컴포넌트, 훅, 서비스, 스토어 등)을 결정하고 조사 계획을 세웁니다.

#### **3단계: 코드 조사 및 수정**

1.  **[AI]** 계획에 따라 관련 코드 파일을 읽고 분석하여 버그의 정확한 위치를 찾습니다.
2.  **[AI]** **최소 변경 원칙**에 따라 버그를 수정하는 코드를 작성하고 적용합니다.
    -   **중요**: 만약 버그의 원인이 `react` 라이브러리 내부에 있는 것으로 의심되면, `react` 패키지 내부에 해당 버그를 재현하는 최소 단위의 **단위 테스트(.test.tsx)를 먼저 추가**하는 것을 강력히 권장합니다.

#### **4. 단계: 검증 요청**

1.  **[AI]** 코드 수정이 완료되면 작업을 멈추고 사용자에게 테스트 재실행을 요청합니다.
    -   **요청 예시**: "장바구니 로직을 수정했습니다. Playwright UI에서 실패했던 테스트를 다시 실행하고 결과를 알려주세요."

#### **5단계: 반복 또는 완료**

1.  **[사용자]** 해당 테스트를 다시 실행하고 결과를 AI에게 전달합니다.
2.  **[AI]**
    -   **테스트 통과 시**: 다음으로 실패하는 테스트에 대해 **1단계**부터 다시 시작합니다. 모든 테스트가 통과하면 최종적으로 작업을 완료하고 보고합니다.
    -   **테스트 실패 시**: 새로운 에러 메시지나 상황을 바탕으로 **2단계**로 돌아가 새로운 가설을 세우고 디버깅을 계속합니다.

---

### 3. 핵심 원칙

-   **테스트 코드 수정 금지 (⭐ 중요)**: E2E 테스트 코드(`e2e/` 폴더 내부 파일)는 절대 수정하지 않습니다. 기존 테스트를 통과시키기 위해 애플리케이션 코드(`packages/app`, `packages/react`)를 수정하는 데에만 집중합니다.
-   **사용자 주도 테스트**: 모든 테스트 실행과 결과 확인은 사용자가 담당합니다.
-   **점진적 접근**: 한 번에 하나의 실패하는 테스트에만 집중하여 문제를 해결합니다.
-   **단위 테스트 우선**: `react` 라이브러리의 버그는 반드시 해당 라이브러리 내의 단위 테스트로 먼저 재현하고 수정합니다.
