# File Reference and Modification Scope Rules

## For AI Agent

### File Reference Syntax

When user provides file references in format `@filename.ts (start-end)`:

- `@` prefix indicates a file reference
- `(start-end)` indicates line range (inclusive)
- Read the exact line range specified
- Understand context by reading a bit before/after if needed for comprehension
- Focus modifications on the specified file and range

### Modification Scope Rules

1. **Strict Scope Adherence**
   - Only modify files explicitly mentioned by user
   - If user says "only modify X", don't modify Y
   - If user specifies a line range, try to keep changes within that range
   - If changes need to extend beyond range, explain why

2. **Protected Files**
   - Test files are protected by default unless explicitly requested
   - If user says "don't modify test files", that's absolute
   - Configuration files should not be modified unless requested
   - Type definition files should be modified carefully

3. **File Modification Priority**
   - Implementation files: Can be modified
   - Test files: Protected unless explicitly requested
   - Configuration: Protected unless explicitly requested
   - Documentation: Can be modified if related to changes

### Reading Strategy

1. **Read Test File First** (if provided)
   - Understand what is being tested
   - Identify expected behavior
   - Note all test cases and edge cases

2. **Read Implementation File**
   - Read the specified line range
   - Read surrounding context if needed
   - Understand current implementation

3. **Read Related Files** (if needed)
   - Read type definitions if types are unclear
   - Read utility functions if they're used
   - Read constants if they're referenced

### Modification Strategy

1. **Identify What Needs to Change**
   - Compare test expectations with current implementation
   - Identify specific functions or logic that need modification
   - Determine if changes can be contained within specified range

2. **Make Minimal Changes**
   - Change only what's necessary to fix the issue
   - Don't refactor unrelated code
   - Don't change code style unnecessarily
   - Maintain existing patterns

3. **Verify Scope**
   - Ensure changes are only in allowed files
   - Ensure test files are not modified (unless requested)
   - Ensure no unintended side effects in other files

### Example Scenarios

**Scenario 1: Test failure fix**

```
User: "@test.ts (10-20) is failing, fix @impl.ts (5-30)"
Action:
- Read test.ts lines 10-20 to understand expectation
- Read impl.ts lines 5-30 to see current code
- Modify only impl.ts to make test pass
- Do NOT modify test.ts
```

**Scenario 2: Specific function fix**

```
User: "Fix normalizeNode in @elements.ts (10-29)"
Action:
- Read elements.ts lines 10-29
- Read surrounding context if needed
- Modify only the normalizeNode function
- Keep changes focused on that function
```

**Scenario 3: Multiple file reference**

```
User: "@test.ts (50-100) fails, current impl is @file1.ts (1-50) and @file2.ts (10-30)"
Action:
- Read all referenced files and ranges
- Determine which file(s) need modification
- Modify only the necessary file(s)
- Respect any "don't modify" constraints
```

---

## ì‚¬ìš©ììš© ì„¤ëª…

### ğŸ“ íŒŒì¼ ì°¸ì¡° êµ¬ë¬¸

`@filename.ts (ì‹œì‘-ë)` í˜•ì‹ì˜ íŒŒì¼ ì°¸ì¡°ê°€ ì œê³µë  ë•Œ:

- `@` ì ‘ë‘ì‚¬ëŠ” íŒŒì¼ ì°¸ì¡°ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤
- `(ì‹œì‘-ë)`ì€ ë¼ì¸ ë²”ìœ„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤ (í¬í•¨)
- ì§€ì •ëœ ì •í™•í•œ ë¼ì¸ ë²”ìœ„ë¥¼ ì½ìŠµë‹ˆë‹¤
- ì´í•´ë¥¼ ìœ„í•´ í•„ìš”ì‹œ ì•ë’¤ë¥¼ ì¡°ê¸ˆ ì½ì–´ ë§¥ë½ì„ ì´í•´í•©ë‹ˆë‹¤
- ì§€ì •ëœ íŒŒì¼ê³¼ ë²”ìœ„ì— ìˆ˜ì •ì„ ì§‘ì¤‘í•©ë‹ˆë‹¤

### ğŸ”’ ìˆ˜ì • ë²”ìœ„ ê·œì¹™

1. **ì—„ê²©í•œ ë²”ìœ„ ì¤€ìˆ˜**
   - ì‚¬ìš©ìê°€ ëª…ì‹œì ìœ¼ë¡œ ì–¸ê¸‰í•œ íŒŒì¼ë§Œ ìˆ˜ì •
   - "Xë§Œ ìˆ˜ì •í•˜ë¼"ê³  í•˜ë©´ YëŠ” ìˆ˜ì •í•˜ì§€ ì•ŠìŒ
   - ë¼ì¸ ë²”ìœ„ê°€ ì§€ì •ë˜ë©´ ë³€ê²½ì„ í•´ë‹¹ ë²”ìœ„ ë‚´ì— ìœ ì§€
   - ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ì•¼ í•˜ë©´ ì´ìœ ë¥¼ ì„¤ëª…

2. **ë³´í˜¸ëœ íŒŒì¼**
   - í…ŒìŠ¤íŠ¸ íŒŒì¼ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë³´í˜¸ë¨ (ëª…ì‹œì  ìš”ì²­ ì—†ì´ëŠ” ìˆ˜ì • ì•ˆ í•¨)
   - "í…ŒìŠ¤íŠ¸ íŒŒì¼ì€ ìˆ˜ì •í•˜ì§€ ë§ˆë¼"ëŠ” ì ˆëŒ€ì  ì§€ì‹œ
   - ì„¤ì • íŒŒì¼ì€ ìš”ì²­í•˜ì§€ ì•ŠëŠ” í•œ ìˆ˜ì •í•˜ì§€ ì•ŠìŒ
   - íƒ€ì… ì •ì˜ íŒŒì¼ì€ ì‹ ì¤‘í•˜ê²Œ ìˆ˜ì •

3. **íŒŒì¼ ìˆ˜ì • ìš°ì„ ìˆœìœ„**
   - êµ¬í˜„ íŒŒì¼: ìˆ˜ì • ê°€ëŠ¥
   - í…ŒìŠ¤íŠ¸ íŒŒì¼: ëª…ì‹œì  ìš”ì²­ ì—†ì´ëŠ” ë³´í˜¸ë¨
   - ì„¤ì • íŒŒì¼: ëª…ì‹œì  ìš”ì²­ ì—†ì´ëŠ” ë³´í˜¸ë¨
   - ë¬¸ì„œ: ë³€ê²½ê³¼ ê´€ë ¨ëœ ê²½ìš° ìˆ˜ì • ê°€ëŠ¥

### ğŸ“– ì½ê¸° ì „ëµ

1. **í…ŒìŠ¤íŠ¸ íŒŒì¼ ë¨¼ì € ì½ê¸°** (ì œê³µëœ ê²½ìš°)
   - ë¬´ì—‡ì´ í…ŒìŠ¤íŠ¸ë˜ëŠ”ì§€ ì´í•´
   - ê¸°ëŒ€ ë™ì‘ ì‹ë³„
   - ëª¨ë“  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì™€ ì—£ì§€ ì¼€ì´ìŠ¤ í™•ì¸

2. **êµ¬í˜„ íŒŒì¼ ì½ê¸°**
   - ì§€ì •ëœ ë¼ì¸ ë²”ìœ„ ì½ê¸°
   - í•„ìš”ì‹œ ì£¼ë³€ ë§¥ë½ ì½ê¸°
   - í˜„ì¬ êµ¬í˜„ ì´í•´

3. **ê´€ë ¨ íŒŒì¼ ì½ê¸°** (í•„ìš”í•œ ê²½ìš°)
   - íƒ€ì…ì´ ë¶ˆëª…í™•í•˜ë©´ íƒ€ì… ì •ì˜ ì½ê¸°
   - ì‚¬ìš©ë˜ëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì½ê¸°
   - ì°¸ì¡°ë˜ëŠ” ìƒìˆ˜ ì½ê¸°

### âœï¸ ìˆ˜ì • ì „ëµ

1. **ë³€ê²½ í•„ìš” ì‚¬í•­ ì‹ë³„**
   - í…ŒìŠ¤íŠ¸ ê¸°ëŒ€ê°’ê³¼ í˜„ì¬ êµ¬í˜„ ë¹„êµ
   - ìˆ˜ì •ì´ í•„ìš”í•œ íŠ¹ì • í•¨ìˆ˜ë‚˜ ë¡œì§ ì‹ë³„
   - ë³€ê²½ì´ ì§€ì •ëœ ë²”ìœ„ ë‚´ì— í¬í•¨ë  ìˆ˜ ìˆëŠ”ì§€ ê²°ì •

2. **ìµœì†Œ ë³€ê²½ ì›ì¹™**
   - ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë° í•„ìš”í•œ ê²ƒë§Œ ë³€ê²½
   - ê´€ë ¨ ì—†ëŠ” ì½”ë“œ ë¦¬íŒ©í† ë§ ê¸ˆì§€
   - ë¶ˆí•„ìš”í•œ ì½”ë“œ ìŠ¤íƒ€ì¼ ë³€ê²½ ê¸ˆì§€
   - ê¸°ì¡´ íŒ¨í„´ ìœ ì§€

3. **ë²”ìœ„ ê²€ì¦**
   - ë³€ê²½ì´ í—ˆìš©ëœ íŒŒì¼ì—ë§Œ ìˆëŠ”ì§€ í™•ì¸
   - í…ŒìŠ¤íŠ¸ íŒŒì¼ì´ ìˆ˜ì •ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸ (ìš”ì²­í•˜ì§€ ì•ŠëŠ” í•œ)
   - ë‹¤ë¥¸ íŒŒì¼ì— ì˜ë„í•˜ì§€ ì•Šì€ ë¶€ì‘ìš©ì´ ì—†ëŠ”ì§€ í™•ì¸
